<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kato’s T-Gel Daily Tracker</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<style>
  :root{
    --bg:#0b0c10; --card:#15171c; --ink:#e9edf1; --muted:#9ba3ae; --accent:#6ee7ff; --accent2:#a78bfa;
    /* metric colors */
    --c-pumps:#90be6d; --t-pumps:rgba(144,190,109,.12);
    --c-mood:#4cc9f0;  --t-mood:rgba(76,201,240,.12);
    --c-libido:#f94144;--t-libido:rgba(249,65,68,.12);
    --c-app:#f8961e;   --t-app:rgba(248,150,30,.12);
    --c-energy:#f9c74f;--t-energy:rgba(249,199,79,.12);
    --c-sleep:#9d4edd; --t-sleep:rgba(157,78,221,.12);
    --c-bg:#06d6a0;    --t-bg:rgba(6,214,160,.12);
    --c-skin:#f72585;  --t-skin:rgba(247,37,133,.12);
    --c-voice:#7209b7; --t-voice:rgba(114,9,183,.12);
    --c-period:#d62828;--t-period:rgba(214,40,40,.12);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto;background:var(--bg);color:var(--ink)}
  .wrap{max-width:1000px;margin:32px auto;padding:0 16px}
  h1{margin:0 0 8px;font-size:28px}
  .sub{color:var(--muted);font-size:14px;margin-bottom:16px}

  .tabs{display:flex;gap:10px;margin:16px 0 20px}
  .tabs button{
    background:#1c1f26;border:1px solid #2a2f38;color:var(--ink);
    padding:10px 14px;border-radius:12px;cursor:pointer;
    transition:background .18s ease, color .18s ease, box-shadow .18s ease, border-color .18s ease
  }
  .tabs button.active{ background:var(--accent); color:#001018; border-color:var(--accent); box-shadow:0 0 18px rgba(110,231,255,.45); }

  .card{background:var(--card);border:1px solid #2a2f38;border-radius:16px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="date"],select,textarea,input[type="text"]{width:100%;background:#0f1116;color:var(--ink);border:1px solid #2a2f38;border-radius:12px;padding:10px 12px}
  textarea{min-height:260px}
  .small-notes{min-height:44px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#001018;border:0;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
  .btn.outline{background:none;border:1px solid #2a2f38;color:var(--ink)}
  .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  .formGrid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .leftCol{display:flex;flex-direction:column;gap:14px}
  .field{border:1px solid #2a2f38;border-radius:12px;padding:12px}
  .rangeWrap{display:flex;gap:12px;align-items:center}
  .rangeWrap output{min-width:2ch;text-align:center}
  @media (max-width:760px){.formGrid{grid-template-columns:1fr} textarea{min-height:160px}}

  /* pastel tints for fields + slider coloring via CSS variable */
  .field[data-color]{background:var(--tint)}
  .field[data-color] input[type="range"]{
    -webkit-appearance:none; width:100%; height:6px; border-radius:999px; background:linear-gradient(90deg,var(--color),var(--color));
    outline:none;
  }
  .field[data-color] input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%; background:var(--color); border:2px solid #0b0c10;
    box-shadow:0 0 0 3px color-mix(in oklab, var(--color) 30%, transparent);
  }
  .field[data-color] input[type="range"]::-moz-range-thumb{
    width:18px;height:18px;border-radius:50%;background:var(--color);border:2px solid #0b0c10;
  }
  .field[data-color] input[type="range"]::-moz-range-track{height:6px;border-radius:999px;background:var(--color)}

  /* Chart canvases: uniform accent-blue glow */
  canvas{background:#0f1116;border:1px solid #2a2f38;border-radius:12px;box-shadow:0 0 12px rgba(110,231,255,.4);}
  .charts{display:grid;gap:16px}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
<div class="wrap">
  <h1>Kato’s T-Gel Daily Tracker</h1>
  <div class="sub">made with love by Ren</div>

  <div class="tabs">
    <button id="tabDaily" class="active">Daily Entry</button>
    <button id="tabOverview">Overview</button>
  </div>

  <!-- DAILY ENTRY -->
  <div id="viewDaily" class="card">
    <div class="formGrid">
      <!-- LEFT COLUMN -->
      <div class="leftCol">
        <!-- Pumps Taken -->
        <div class="field" data-color style="--color:var(--c-pumps);--tint:var(--t-pumps)">
          <label for="pumps">Pumps of T-Gel taken today</label>
          <select id="pumps">
            <option value="">-- Select --</option>
            <option value="0.5">½</option>
            <option value="1">1</option>
            <option value="1.5">1.5</option>
            <option value="2">2</option>
          </select>
        </div>
        <!-- Date -->
        <div class="field" data-color style="--color:#9ba3ae;--tint:rgba(155,163,174,.12)">
          <label for="date">Date</label>
          <input id="date" type="date">
        </div>

        <!-- Mood -->
        <div class="field" data-color style="--color:var(--c-mood);--tint:var(--t-mood)">
          <label for="mood">Mood (1–5)</label>
          <div class="rangeWrap">
            <input id="mood" type="range" min="1" max="5" step="1"><output id="moodVal"></output>
          </div>
        </div>

        <!-- Libido -->
        <div class="field" data-color style="--color:var(--c-libido);--tint:var(--t-libido)">
          <label for="libido">Libido (1–5)</label>
          <div class="rangeWrap">
            <input id="libido" type="range" min="1" max="5" step="1"><output id="libidoVal"></output>
          </div>
        </div>

        <!-- Appetite -->
        <div class="field" data-color style="--color:var(--c-app);--tint:var(--t-app)">
          <label for="appetite">Appetite (1–5)</label>
          <div class="rangeWrap">
            <input id="appetite" type="range" min="1" max="5" step="1"><output id="appetiteVal"></output>
          </div>
        </div>

        <!-- Energy -->
        <div class="field" data-color style="--color:var(--c-energy);--tint:var(--t-energy)">
          <label for="energy">Energy (1–5)</label>
          <div class="rangeWrap">
            <input id="energy" type="range" min="1" max="5" step="1"><output id="energyVal"></output>
          </div>
        </div>

        <!-- Sleep -->
        <div class="field" data-color style="--color:var(--c-sleep);--tint:var(--t-sleep)">
          <label for="sleep">Sleep Quality (1–5)</label>
          <div class="rangeWrap">
            <input id="sleep" type="range" min="1" max="5" step="1"><output id="sleepVal"></output>
          </div>
        </div>

        <!-- Bottom Growth -->
        <div class="field" data-color style="--color:var(--c-bg);--tint:var(--t-bg)">
          <label>Bottom Growth</label>
          <div class="row">
            <label><input type="checkbox" id="bgSwelling"> Swelling</label>
            <label><input type="checkbox" id="bgSensitivity"> Sensitivity</label>
          </div>
          <input id="bgNotes" class="small-notes" type="text" placeholder="Notes on bottom growth">
        </div>

        <!-- Skin -->
        <div class="field" data-color style="--color:var(--c-skin);--tint:var(--t-skin)">
          <label for="skin">Skin Changes (1–5)</label>
          <div class="rangeWrap">
            <input id="skin" type="range" min="1" max="5" step="1"><output id="skinVal"></output>
          </div>
        </div>

        <!-- Voice -->
        <div class="field" data-color style="--color:var(--c-voice);--tint:var(--t-voice)">
          <label>Voice</label>
          <div class="row">
            <label><input type="checkbox" id="voiceCracking"> Cracking</label>
            <label><input type="checkbox" id="voiceDeeper"> Deeper tone</label>
            <label><input type="checkbox" id="voiceNoChange"> No change</label>
          </div>
          <input id="voiceNotes" class="small-notes" type="text" placeholder="Notes on voice">
        </div>

        <!-- Period -->
        <div class="field" data-color style="--color:var(--c-period);--tint:var(--t-period)">
          <label for="period">Period?</label>
          <select id="period">
            <option value="">-- Select --</option>
            <option value="none">None</option>
            <option value="spotting">Spotting</option>
            <option value="light">Light</option>
            <option value="medium">Medium</option>
            <option value="heavy">Heavy</option>
          </select>
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div>
        <div class="field" data-color style="--color:#89a1b4;--tint:rgba(137,161,180,.12)">
          <label for="notes">General Notes</label>
          <textarea id="notes"></textarea>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="saveBtn">Save Entry</button>
      <button class="btn outline" id="exportCsv">Export CSV</button>
      <input type="file" id="importCsv" style="display:none">
      <button class="btn outline" id="importBtn">Import CSV</button>
      <label class="row" style="font-size:13px;color:var(--muted)">
        <input id="autoBackup" type="checkbox" style="margin-right:8px">
        Auto-backup CSV on Save
      </label>
    </div>
  </div>

  <!-- OVERVIEW -->
  <div id="viewOverview" class="card" style="display:none">
    <div class="charts">
      <canvas id="lineAll" height="320"></canvas>
      <canvas id="barAll" height="380"></canvas>
    </div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const KEY = 'tgel-tracker-entries-v1';
const BACKUP_KEY = 'tgel-tracker-auto-backup';

function todayISO(){ const d=new Date(); const off=d.getTimezoneOffset(); return new Date(d.getTime()-off*60000).toISOString().slice(0,10); }
function getEntries(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]');}catch{return []} }
function setEntries(list){ localStorage.setItem(KEY, JSON.stringify(list)); }

function toCSV(rows){
  const headers = Object.keys(rows[0]||{});
  return [headers.join(','), ...rows.map(r=>headers.map(h=>JSON.stringify(r[h]??'')).join(','))].join('\n');
}
function downloadCSV(rows, filename){
  const blob=new Blob([toCSV(rows)],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=filename; a.click();
  URL.revokeObjectURL(url);
}

function saveEntry(){
  const entry={
    date: $('date').value,
    pumps: $('pumps').value,
    mood: $('mood').value,
    libido: $('libido').value,
    appetite: $('appetite').value,
    energy: $('energy').value,
    sleep: $('sleep').value,
    bgSwelling: $('bgSwelling').checked,
    bgSensitivity: $('bgSensitivity').checked,
    bgNotes: $('bgNotes').value,
    skin: $('skin').value,
    voiceCracking: $('voiceCracking').checked,
    voiceDeeper: $('voiceDeeper').checked,
    voiceNoChange: $('voiceNoChange').checked,
    voiceNotes: $('voiceNotes').value,
    period: $('period').value,
    notes: $('notes').value
  };
  let list = getEntries().filter(e=>e.date!==entry.date);
  list.push(entry);
  list.sort((a,b)=>a.date<b.date?-1:1);
  setEntries(list);

  if ($('autoBackup').checked){
    const ts=new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
    downloadCSV(list,`tgel-tracker-backup-${ts}.csv`);
  }
  alert('Saved! Great work, you sexy thing!');
}

$('saveBtn').onclick = saveEntry;
$('exportCsv').onclick = () => downloadCSV(getEntries(),'tgel-tracker.csv');
$('importBtn').onclick = () => $('importCsv').click();
$('importCsv').onchange = e => {
  const file=e.target.files[0]; if(!file) return;
  const r=new FileReader();
  r.onload=()=>{
    const text=String(r.result||'').trim();
    if(!text){ alert('Empty file'); return; }
    const [header, ...lines] = text.split(/\r?\n/);
    const keys = header.split(',');
    const rows = lines.filter(Boolean).map(line=>{
      const vals=line.split(',').map(v=>{ try{return JSON.parse(v);}catch{return v.replace(/^"|"$/g,'')} });
      return Object.fromEntries(keys.map((k,i)=>[k, vals[i]]));
    });
    setEntries(rows);
    alert('Import complete!');
  };
  r.readAsText(file);
};

// tabs with active styling
function showDaily(){ $('viewDaily').style.display='block'; $('viewOverview').style.display='none'; $('tabDaily').classList.add('active'); $('tabOverview').classList.remove('active'); }
function showOverview(){ $('viewDaily').style.display='none'; $('viewOverview').style.display='block'; $('tabDaily').classList.remove('active'); $('tabOverview').classList.add('active'); renderCharts(); }
$('tabDaily').onclick = showDaily;
$('tabOverview').onclick = showOverview;

// init date + range outputs + auto-backup toggle
window.addEventListener('DOMContentLoaded', ()=>{
  $('date').value = todayISO();
  ['mood','libido','appetite','energy','sleep','skin'].forEach(id=>{
    const el=$(id), out=$(id+'Val'); const set=()=>out.textContent=el.value; set(); el.addEventListener('input', set);
  });
  try{ const pref=localStorage.getItem(BACKUP_KEY); if(pref!==null) $('autoBackup').checked = pref==='1'; }catch{}
  $('autoBackup').addEventListener('change', ()=>localStorage.setItem(BACKUP_KEY, $('autoBackup').checked?'1':'0'));
});

// ----- Charts (2 only) -----
let charts = {};
function destroyCharts(){ for(const k in charts){ try{ charts[k].destroy(); }catch{} } charts={}; }

function renderCharts(){
  destroyCharts();
  const data = getEntries().sort((a,b)=>new Date(a.date)-new Date(b.date));
  const labels = data.map(e=>e.date);

  // 1) MULTI-LINE: Mood, Libido, Energy, Sleep
  charts.lineAll = new Chart($('lineAll').getContext('2d'), {
    type:'line',
    data:{
      labels,
      datasets:[
        {label:'Mood',   data:data.map(e=>+e.mood||0),   borderColor:getComputedStyle(document.documentElement).getPropertyValue('--c-mood').trim(),   backgroundColor:'rgba(76,201,240,.2)', fill:true, tension:.3},
        {label:'Libido', data:data.map(e=>+e.libido||0), borderColor:getComputedStyle(document.documentElement).getPropertyValue('--c-libido').trim(), backgroundColor:'rgba(249,65,68,.2)',  fill:true, tension:.3},
        {label:'Energy', data:data.map(e=>+e.energy||0), borderColor:getComputedStyle(document.documentElement).getPropertyValue('--c-energy').trim(), backgroundColor:'rgba(249,199,79,.2)', fill:true, tension:.3},
        {label:'Sleep',  data:data.map(e=>+e.sleep||0),  borderColor:getComputedStyle(document.documentElement).getPropertyValue('--c-sleep').trim(),  backgroundColor:'rgba(157,78,221,.2)', fill:true, tension:.3},
      ]
    },
    options:{
      responsive:true,
      plugins:{ legend:{ labels:{ color:'#cfd6df' } } },
      scales:{
        x:{ ticks:{ color:'#9ba3ae' } },
        y:{ ticks:{ color:'#9ba3ae' }, min:0, max:5, suggestedMax:5 }
      }
    }
  });

  // 2) ONE BIG BAR: everything else (counts)
  // Build bars and colors
  const pumps = {'½':0,'1':0,'1.5':0,'2':0};
  data.forEach(e=>{ if(e.pumps==='0.5') pumps['½']++; else if(pumps[e.pumps]!=null) pumps[e.pumps]++; });
  const appetite = {'1':0,'2':0,'3':0,'4':0,'5':0}; data.forEach(e=>{ const v=String(e.appetite||''); if(appetite[v]!=null) appetite[v]++; });
  const skin = {'1':0,'2':0,'3':0,'4':0,'5':0};     data.forEach(e=>{ const v=String(e.skin||''); if(skin[v]!=null) skin[v]++; });
  const period = {None:0,Spotting:0,Light:0,Medium:0,Heavy:0};
  data.forEach(e=>{
    const v=String(e.period||'');
    if(v==='none') period.None++;
    else if(v==='spotting') period.Spotting++;
    else if(v==='light') period.Light++;
    else if(v==='medium') period.Medium++;
    else if(v==='heavy') period.Heavy++;
  });
  const bottomGrowth = {Swelling: data.filter(e=>e.bgSwelling).length, Sensitivity: data.filter(e=>e.bgSensitivity).length};
  const voice = {Cracking:0,'Deeper tone':0,'No change':0};
  data.forEach(e=>{ if(e.voiceCracking) voice['Cracking']++; if(e.voiceDeeper) voice['Deeper tone']++; if(e.voiceNoChange) voice['No change']++; });

  // Flatten into one bar series (labels + values + colors)
  const barLabels = [
    'Pumps ½','Pumps 1','Pumps 1.5','Pumps 2',
    'Appetite 1','Appetite 2','Appetite 3','Appetite 4','Appetite 5',
    'Skin 1','Skin 2','Skin 3','Skin 4','Skin 5',
    'Period None','Period Spotting','Period Light','Period Medium','Period Heavy',
    'Bottom Growth Swelling','Bottom Growth Sensitivity',
    'Voice Cracking','Voice Deeper tone','Voice No change'
  ];
  const barValues = [
    pumps['½'],pumps['1'],pumps['1.5'],pumps['2'],
    appetite['1'],appetite['2'],appetite['3'],appetite['4'],appetite['5'],
    skin['1'],skin['2'],skin['3'],skin['4'],skin['5'],
    period.None,period.Spotting,period.Light,period.Medium,period.Heavy,
    bottomGrowth.Swelling,bottomGrowth.Sensitivity,
    voice['Cracking'],voice['Deeper tone'],voice['No change']
  ];
  const c = getComputedStyle(document.documentElement);
  const color = name => c.getPropertyValue(name).trim();
  const barColors = [
    /* pumps */ color('--c-pumps'),color('--c-pumps'),color('--c-pumps'),color('--c-pumps'),
    /* appetite */ color('--c-app'),color('--c-app'),color('--c-app'),color('--c-app'),color('--c-app'),
    /* skin */ color('--c-skin'),color('--c-skin'),color('--c-skin'),color('--c-skin'),color('--c-skin'),
    /* period */ color('--c-period'),color('--c-period'),color('--c-period'),color('--c-period'),color('--c-period'),
    /* bottom growth */ color('--c-bg'),color('--c-bg'),
    /* voice */ color('--c-voice'),color('--c-voice'),color('--c-voice')
  ];

  charts.barAll = new Chart($('barAll').getContext('2d'), {
    type:'bar',
    data:{ labels:barLabels, datasets:[{ label:'Counts', data:barValues, backgroundColor:barColors }] },
    options:{
      responsive:true,
      plugins:{ legend:{ labels:{ color:'#cfd6df' } } },
      scales:{ x:{ ticks:{ color:'#9ba3ae', maxRotation:45, minRotation:45 } }, y:{ ticks:{ color:'#9ba3ae' }, beginAtZero:true } }
    }
  });
}
</script>
</body>
</html>
